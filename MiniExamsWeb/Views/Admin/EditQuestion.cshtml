@using BussinessLayer
@model List<Questions>
@{
    ViewData["Title"] = "Edit Questions";
    Exams exam = ViewBag.Exam;
}

<div class="animate-fade-in">
    <div class="page-header" style="margin-bottom: 2rem;">
        <div style="display: flex; align-items: center; gap: 15px;">
            <a href="/Admin/EditExams" style="color: var(--text-secondary); font-size: 1.25rem;"><i class="fas fa-chevron-left"></i></a>
            <div>
                <h1 style="font-size: 2rem; margin-bottom: 0.25rem;">@exam.Title</h1>
                <p style="color: var(--text-secondary);">Manage questions and answers for this assessment.</p>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 350px 1fr; gap: 2rem; align-items: start;">
        <!-- Left Column: Exam Summary -->
        <aside class="card" style="position: sticky; top: 2rem;">
            <h3 style="margin-bottom: 1.5rem; color: var(--accent-primary);">Exam Summary</h3>
            <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                <div>
                    <span style="display: block; font-size: 0.75rem; text-transform: uppercase; color: var(--text-muted); margin-bottom: 4px;">Description</span>
                    <p style="font-size: 0.95rem;">@exam.Description</p>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 12px; text-align: center;">
                        <i class="far fa-clock" style="display: block; margin-bottom: 8px; color: var(--accent-primary);"></i>
                        <span style="font-weight: 700; display: block;">@exam.QuizTime</span>
                        <span style="font-size: 0.7rem; color: var(--text-muted);">Minutes</span>
                    </div>
                    <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 12px; text-align: center;">
                        <i class="fas fa-tasks" style="display: block; margin-bottom: 8px; color: var(--accent-secondary);"></i>
                        <span style="font-weight: 700; display: block;">@Model.Count</span>
                        <span style="font-size: 0.7rem; color: var(--text-muted);">Questions</span>
                    </div>
                </div>
                <div style="border-top: 1px solid var(--border-color); padding-top: 1.5rem;">
                    <button class="btn-primary" style="width: 100%; justify-content: center; background: rgba(56, 189, 248, 0.1); color: var(--accent-primary); border: 1px solid rgba(56, 189, 248, 0.2);"
                            onclick="window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'})">
                        <i class="fas fa-plus-circle"></i> New Question
                    </button>
                </div>
            </div>
        </aside>

        <!-- Right Column: Questions Management -->
        <div style="display: flex; flex-direction: column; gap: 1.5rem;">
            @foreach (var question in Model)
            {
                <div class="card" style="position: relative; border-left: 4px solid var(--accent-primary);">
                    <form action="/Admin/SaveQuestion" method="post">
                        <input type="hidden" name="QuestionID" value="@question.ID" />
                        <input type="hidden" name="examId" value="@exam.ID" />

                        <div style="display: flex; justify-content: space-between; margin-bottom: 1.5rem;">
                            <h4 style="color: var(--text-secondary); font-weight: 500;">Question Details</h4>
                            <div style="display: flex; gap: 8px;">
                                <button type="submit" style="background: none; border: none; color: var(--success); cursor: pointer;" title="Save Changes">
                                    <i class="fas fa-save"></i>
                                </button>
                                <a href="/Admin/DeleteQuestion?questionId=@question.ID&examId=@exam.ID" 
                                   style="color: var(--danger);" onclick="return confirm('Delete this question permanentely?')" title="Delete">
                                    <i class="fas fa-trash-alt"></i>
                                </a>
                            </div>
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <textarea name="Text" required style="width: 100%; background: var(--bg-primary); border: 1px solid var(--border-color); padding: 12px; border-radius: var(--radius-md); color: var(--text-primary); font-size: 1.1rem; line-height: 1.5; outline: none; transition: border-color 0.2s;"
                                      onfocus="this.style.borderColor='var(--accent-primary)'" onblur="this.style.borderColor='var(--border-color)'">@question.Text</textarea>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            @for (int i = 0; i < 4; i++)
                            {
                                <div style="background: rgba(0,0,0,0.2); padding: 12px; border-radius: var(--radius-md); border: 1px solid @(question.CorrectAnswer == i + 1 ? "var(--success)" : "var(--border-color)"); position: relative;">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <input type="radio" name="CorrectAnswer" value="@(i+1)" @(question.CorrectAnswer == i + 1 ? "checked" : "") required 
                                               style="accent-color: var(--success); width: 18px; height: 18px; cursor: pointer;" />
                                        <input type="text" name="Options[@i]" value="@question.Options[i]" required 
                                               style="background: transparent; border: none; color: var(--text-primary); width: 100%; outline: none;" />
                                    </div>
                                    @if (question.CorrectAnswer == i + 1)
                                    {
                                        <span style="position: absolute; top: -10px; right: 10px; background: var(--success); color: white; font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; text-transform: uppercase;">Correct</span>
                                    }
                                </div>
                            }
                        </div>
                    </form>
                </div>
            }

            <!-- Add New Question Card -->
            <div class="card" style="border: 2px dashed var(--border-color); background: rgba(255,255,255,0.01);">
                <h3 style="margin-bottom: 1.5rem; text-align: center; color: var(--text-secondary);">
                    <i class="fas fa-plus-circle"></i> Add New Question
                </h3>
                <form action="/Admin/AddQuestion" method="get">
                    <input type="hidden" name="examId" value="@exam.ID" />
                    
                    <div style="margin-bottom: 1.5rem;">
                        <textarea name="Text" placeholder="Typer your question here..." required 
                                  style="width: 100%; background: var(--bg-primary); border: 1px solid var(--border-color); padding: 15px; border-radius: var(--radius-md); color: var(--text-primary); font-size: 1.1rem; outline: none;"
                                  onfocus="this.style.borderColor='var(--accent-primary)'" onblur="this.style.borderColor='var(--border-color)'"></textarea>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                        @for (int i = 0; i < 4; i++)
                        {
                            <div style="background: var(--bg-primary); padding: 12px; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <input type="radio" name="CorrectAnswer" value="@(i+1)" @(i == 0 ? "checked" : "") required 
                                           style="accent-color: var(--success); width: 18px; height: 18px;" />
                                    <input type="text" name="Options[@i]" placeholder="Option @(i+1)" required 
                                           style="background: transparent; border: none; color: white; width: 100%; outline: none;" />
                                </div>
                            </div>
                        }
                    </div>

                    <div style="text-align: center;">
                        <button type="submit" class="btn-primary" 
                                style="background: var(--accent-gradient); border: none; padding: 12px 40px; border-radius: var(--radius-md); color: white; font-weight: 600; cursor: pointer; box-shadow: var(--glow-primary);">
                             Add Question to Exam
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>